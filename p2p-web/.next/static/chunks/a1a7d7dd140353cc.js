(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,78995,t=>{"use strict";let e=t.i(85171).default.env.NEXT_PUBLIC_API_URL||"http://localhost:8080";class a{static baseUrl=`${e}/api/v1/auth`;static async login(t){let e=await fetch(`${this.baseUrl}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw await this.extractErrorData(e);return e.json()}static async register(t){let e=await fetch(`${this.baseUrl}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw await this.extractErrorData(e);return e.json()}static async logout(t){let e=await fetch(`${this.baseUrl}/logout`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(!e.ok)throw await this.extractErrorData(e)}static async forgotPassword(t){let e=await fetch(`${this.baseUrl}/forgot-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t})});if(!e.ok)throw await this.extractErrorData(e)}static async resetPassword(t,e){let a=await fetch(`${this.baseUrl}/reset-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t,password:e})});if(!a.ok)throw await this.extractErrorData(a)}static async verifyEmail(t){let e=await fetch(`${this.baseUrl}/verify-email`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t})});if(!e.ok)throw await this.extractErrorData(e)}static async sendVerificationCode(t){let e=await fetch(`${this.baseUrl}/send-verification-code`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw await this.extractErrorData(e);return e.json()}static async getWeChatAuthorizeUrl(){let t=await fetch(`${this.baseUrl}/oauth/wechat/authorize-url`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw await this.extractErrorData(t);return t.json()}static async weChatOAuthCallback(t){let e=await fetch(`${this.baseUrl}/oauth/wechat/callback`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok)throw await this.extractErrorData(e);return e.json()}static async extractErrorData(t){let e={code:t.status,message:`HTTP error! status: ${t.status}`,response:{status:t.status,data:null}};try{let a=t.headers.get("content-type");if(a&&a.includes("application/json")){let a=await t.json();e={...e,...a,response:{...e.response,data:a}}}else{let a=await t.text();e.message=a||e.message}}catch(t){}let a=Error(e.message||"Request failed");throw a.response=e.response,a.code=e.code,a}}t.s(["default",0,a,"getWeChatAuthorizeUrl",0,()=>a.getWeChatAuthorizeUrl(),"login",0,t=>a.login(t),"register",0,t=>a.register(t),"sendVerificationCode",0,t=>a.sendVerificationCode(t),"weChatOAuthCallback",0,t=>a.weChatOAuthCallback(t)])},63486,t=>{"use strict";var e=t.i(94187),a=t.i(95594),r=t.i(78995);let o=(0,a.createContext)(void 0);function s({children:t}){let s=function(){let[t,e]=(0,a.useState)(null),[o,s]=(0,a.useState)(!1),[i,n]=(0,a.useState)(null);(0,a.useEffect)(()=>{let t=localStorage.getItem("auth_token")||sessionStorage.getItem("auth_token"),a=localStorage.getItem("auth_user")||sessionStorage.getItem("auth_user");if(t&&a)try{e(JSON.parse(a))}catch(t){console.error("Failed to parse user data:",t)}},[]);let l=(0,a.useCallback)(async t=>{s(!0),n(null);try{let a=await r.default.login(t);if(200===a.code&&a.data){let{token:r,user:o}=a.data;t.rememberMe?(localStorage.setItem("auth_token",r),localStorage.setItem("auth_user",JSON.stringify(o))):(sessionStorage.setItem("auth_token",r),sessionStorage.setItem("auth_user",JSON.stringify(o))),e(o)}else n(a.message||"登录失败")}catch(t){throw n(t instanceof Error?t.message:"登录失败，请重试"),t}finally{s(!1)}},[]),c=(0,a.useCallback)(async t=>{s(!0),n(null);try{let a=await r.default.register(t);if(200===a.code&&a.data){let{token:t,user:r}=a.data;localStorage.setItem("auth_token",t),localStorage.setItem("auth_user",JSON.stringify(r)),e(r)}else n(a.message||"注册失败")}catch(t){throw n(t instanceof Error?t.message:"注册失败，请重试"),t}finally{s(!1)}},[]);return{user:t,isLoading:o,error:i,login:l,register:c,logout:(0,a.useCallback)(async()=>{let t=localStorage.getItem("auth_token")||sessionStorage.getItem("auth_token");try{t&&await r.default.logout(t)}catch(t){console.error("Logout error:",t)}finally{localStorage.removeItem("auth_token"),localStorage.removeItem("auth_user"),sessionStorage.removeItem("auth_token"),sessionStorage.removeItem("auth_user"),e(null)}},[]),clearError:(0,a.useCallback)(()=>{n(null)},[])}}();return(0,e.jsx)(o.Provider,{value:s,children:t})}function i(){let t=(0,a.useContext)(o);if(void 0===t)throw Error("useAuthContext must be used within an AuthProvider");return t}t.s(["AuthProvider",()=>s,"default",0,o,"useAuthContext",()=>i],63486)}]);